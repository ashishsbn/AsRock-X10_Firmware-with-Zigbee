<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="includes/jquery.min.js"></script>
<script type="text/javascript" src="includes/json2.js"></script>
<script type="text/javascript" src="includes/asrock.js"></script>
<script type="text/javascript">writeTitle();</script>
<script type="text/javascript" src="lang/multilanguage.js"></script>
<link rel="stylesheet" type="text/css" href="default.css" />
<script type="text/javascript">
var apSettings = {};

function copyWirelessSettings(checked)
{
  if (checked) {
    $('input#ssid5g').val($('input#ssid2g').val() + '_5G');
    $('input#psk5g').val($('input#psk2g').val());
  }
}

function setlanSettings()
{
  apSettings.lanType = $('input[id=lanType]:checked').val();
  $('#lanSettings').hide();

  if (apSettings.lanType == "dhcp") {
    goToWirelessSettings();
  }
  else {
    $('#lanStaticSettings').show();
  }
}

function checkWirelessSettings()
{
  var ssid2g, psk2g, ssid5g, psk5g;

  ssid2g = $('input#ssid2g').val();
  if (!checkSSID(ssid2g) || !checkSpace(ssid2g)) {
    alert(WirelessWarn1);
    $('input#ssid2g').focus();
    return false;
  }

  psk2g = $('input#psk2g').val();
  if (psk2g.length < 8) {
    alert(WirelessWarn2);
    $('input#psk2g').focus();
    return false;
  }
  else if (psk2g.length > 63) {
    alert(WirelessWarn3);
    $('input#psk2g').focus();
    return false;
  }
  else if (!checkSpace(psk2g)) {
    alert(WirelessWarnPsk);
    $('input#psk2g').focus();
    return false;
  }

  ssid5g = $('input#ssid5g').val();
  if (!checkSSID(ssid5g) || !checkSpace(ssid5g)) {
    alert(WirelessWarn1);
    $('input#ssid5g').focus();
    return false;
  }

  psk5g = $('input#psk5g').val();
  if (psk5g.length < 8) {
    alert(WirelessWarn2);
    $('input#psk5g').focus();
    return false;
  }
  else if (psk5g.length > 63) {
    alert(WirelessWarn3);
    $('input#psk5g').focus();
    return false;
  }
  else if (!checkSpace(psk5g)) {
    alert(WirelessWarnPsk);
    $('input#psk5g').focus();
    return false;
  }

  requiredData.ssid2g = ssid2g;
  requiredData.psk2g = psk2g;
  requiredData.ssid5g = ssid5g;
  requiredData.psk5g = psk5g;

  return true;
}

function goToWirelessSettings()
{
  $('#wirelessSettings').show();
}

function setApSettings()
{
  var argu;

  argu = "lanType=" + apSettings.lanType;
  if (apSettings.lanType == "static") {
    argu += "&ipAddr=" + apSettings.ipAddr;
    argu += "&subnet=" + apSettings.subnet;
    argu += "&gateway=" + apSettings.gateway;
    argu += "&dns1=" + apSettings.dns1;
    argu += "&dns2=" + apSettings.dns2;
  }
  argu += "&ssid2g=" + encodeURIComponent($('input#ssid2g').val());
  argu += "&psk2g=" + encodeURIComponent($('input#psk2g').val());
  argu += "&ssid5g=" + encodeURIComponent($('input#ssid5g').val());
  argu += "&psk5g=" + encodeURIComponent($('input#psk5g').val());

  $.ajax({
    url: "/f/ap/wizardSetAp",
    type: "POST",
    data: argu,
    dataType: "json",
    success: function(result) {
      console.log(result);
    },
    error : function() {
      console.log("post /f/ap/wizardSetAp error");
    }
  });
}

$(document).ready(function() {
  /* Get the data and fill the DOM */
  var lanInfo = getData("/f/ap/wizardGetLan");
  if (lanInfo != null) {
    if (lanInfo.proto == "static") {
      $('input#lanType').filter('[value=static]').prop('checked', true);
    }
    $('input#staticIpAddr').val(lanInfo.staticIpAddr);
    $('input#staticSubnet').val(lanInfo.staticSubnet);
    $('input#staticGateway').val(lanInfo.staticGateway);
    $('input#staticDns1').val(lanInfo.staticDns1);
    $('input#staticDns2').val(lanInfo.staticDns2);
  }

  var wirelessInfo = getData("/f/ap/wizardGetWireless");
  if (wirelessInfo != null) {
    wirelessInfo.ssid2g = decodeURIComponent(wirelessInfo.ssid2g);
    wirelessInfo.auth2g = decodeURIComponent(wirelessInfo.auth2g);
    wirelessInfo.psk2g = decodeURIComponent(wirelessInfo.psk2g);
    wirelessInfo.ssid5g = decodeURIComponent(wirelessInfo.ssid5g);
    wirelessInfo.auth5g = decodeURIComponent(wirelessInfo.auth5g);
    wirelessInfo.psk5g = decodeURIComponent(wirelessInfo.psk5g);
    $('input#ssid2g').val(wirelessInfo.ssid2g);
    $('input#psk2g').val(wirelessInfo.psk2g);
    $('input#ssid5g').val(wirelessInfo.ssid5g);
    $('input#psk5g').val(wirelessInfo.psk5g);
  }

  $('#lanToWireless').click(function(event) {
    setlanSettings();
  });

  $('#staticToWireless').click(function(event) {
    apSettings.ipAddr = $('input#staticIpAddr').val();
    apSettings.subnet = $('input#staticSubnet').val();
    apSettings.gateway = $('input#staticGateway').val();
    apSettings.dns1 = $('input#staticDns1').val();
    apSettings.dns2 = $('input#staticDns2').val();

    if (!checkIPAddr(apSettings.ipAddr) || isLocalhost(apSettings.ipAddr)) {
      alert(LANWarn1);
      $('input#staticIpAddr').focus();
      return;
    }

    if (!checkIPMask(apSettings.subnet)) {
      $("input#staticSubnet").focus();
      return;
    }

    if(!checkIPAddr(apSettings.gateway)){
      alert(WANWarn3);
      $('input#staticGateway').focus();
      return;
    }

    if (!checkIPAddr(apSettings.dns1)) {
      alert(WANWarn2);
      $('input#staticDns1').focus();
      return;
    }

    if (apSettings.dns2!="") {
      if (!checkIPAddr(apSettings.dns2)) {
        alert(WANWarn2);
        $('input#staticDns2').focus();
        return;
      }
    }

    $('#lanStaticSettings').hide();
    goToWirelessSettings();
  });
  
  $('#completeAp').click(function(event) {
    if (checkWirelessSettings()) {
      setApSettings();
	  setOpModePara(2);
      showWindow("waitWindow");
      countdownWindow("rebootingDig");
    }
  });

  $('#cancelAp').click(function(event) {
    refresh('ap/dashboard.html');
  });

  $('input#ssid2g').keyup(function(){
    copyWirelessSettings($('input#copyWireless').prop("checked"));
  });
  $('input#psk2g').keyup(function(){
    copyWirelessSettings($('input#copyWireless').prop("checked"));
  });
});
</script>
</head>
<body onload="preloadX10Images()">
<div style="width:960px;margin:0px auto;">
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td height="20" valign="top">&nbsp;</td>
        </tr>
        <script type="text/javascript">writeHeader();</script>
		<tr>
          <td align="center" background="images/UI-new_10.png">
            <div id="lanSettings">
              <table width="95%" border="0" cellspacing="2" cellpadding="2">
                <tr>
                  <td width="3%" height="25" align="left">
                    <input type="radio" id="lanType" name="lanType" value="dhcp" checked></input>
                  </td>
                  <td width="97%" align="left"><h4><script>document.write(ApLanDhcp);</script></h4></td>
                </tr>
                <tr>
                  <td><input type="radio" id="lanType" name="lanType" value="static"></input></td>
                  <td align="left"><h4><script>document.write(ApLanStatic);</script></h4></td>
                </tr>
                <tr>
                  <td align="left" class="style6">&nbsp;</td>
                </tr>
                <tr>
                  <td colspan="2" align="center"><table width="119" height="39" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td class="button1" id="lanToWireless"><a><script>document.write(StartWirelessNext);</script></a></td>
                    </tr>
                  </table></td>
                </tr>
              </table>
            </div>
            <div id="lanStaticSettings" style="display:none">
              <table width="95%" align="center" border="0" cellspacing="2" cellpadding="2">
			    <tr>
                  <td width="25%"></td>
                  <td width="50%" align="left">
                    <h4><script>document.write(SelectType3WarnStatucSetting);</script></h4>
                    <table width="100%">
                      <tr>
                        <td width="28%" align="left" class="style8">
                          <script>document.write(SelectType4WarnIPAddr);</script>
                        </td>
                        <td width="72%" align="left" class="style8" maxlength="32">
                          <input type="text" id="staticIpAddr"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(SelectType3WarnSubnet);</script>
                        </td>
                        <td align="left" class="style8" maxlength="32">
                          <input type="text" id="staticSubnet"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(SelectType3WarnGateway);</script>
                        </td>
                        <td align="left" class="style8" maxlength="32">
                          <input type="text" id="staticGateway"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(SelectType3WarnDDNS1);</script>
                        </td>
                        <td align="left" class="style8" maxlength="32">
                          <input type="text" id="staticDns1"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(SelectType3WarnDDNS2);</script>
                        </td>
                        <td align="left" class="style8" maxlength="32">
                          <input type="text" id="staticDns2"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style6">&nbsp;</td>
                      </tr>
                      <tr>
                        <td colspan="2" align="center"><table width="119" height="39" border="0" cellspacing="0" cellpadding="0">
                          <tr>
                            <td class="button1" id="staticToWireless"><a><script>document.write(StartWirelessNext);</script></a></td>
                          </tr>
                        </table></td>
                      </tr>
                    </table>
                  </td>
                  <td width="25%"></td>
                </tr>
              </table>
            </div>
            <div id="wirelessSettings" style="display:none">
              <table width="95%" align="center" border="0" cellspacing="2" cellpadding="2">
			    <tr>
                  <td width="25%"></td>
                  <td width="50%" align="left"><h4><script>document.write(StartWirelessSetting);</script></h4>
                    <table width="100%">
                      <tr>
                        <td colspan="2" align="left" class="style8">&nbsp;</td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left" class="style7"><script>document.write(StartWireless2GSecurity);</script></td>
                        <td></td>
                      </tr>
                      <tr>
                        <td width="28%" align="left" class="style8">
                          <script>document.write(StartWirelessName);</script>
                        </td>
                        <td width="72%" align="left" class="style8">
                          <input type="text" id="ssid2g" maxlength="32"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(StartWirelessPassword);</script>
                        </td>
                        <td align="left" class="style8">
                          <input type="text" id="psk2g" maxlength="63"></input>
                        </td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left">&nbsp;</td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left" class="style8">
                          <input type="checkbox" id="copyWireless" onclick="copyWirelessSettings(this.checked);" checked></input>
                          <script>document.write(StartWirelessCopy);</script>
                        </td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left"><img src="images/line.png" width="100%" height="5" /></td>
                      </tr>
                      <tr>
                        <td colspan="2" align="left" class="style7"><script>document.write(StartWireless5GSecurity);</script></td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(StartWirelessName);</script>
                        </td>
                        <td align="left" class="style8">
                          <input type="text" id="ssid5g" maxlength="32"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style8">
                          <script>document.write(StartWirelessPassword);</script>
                        </td>
                        <td align="left" class="style8">
                          <input type="text" id="psk5g" maxlength="63"></input>
                        </td>
                      </tr>
                      <tr>
                        <td align="left" class="style6">&nbsp;</td>
                      </tr>
                      <tr>
                        <td><table width="119" height="39" border="0" cellspacing="0" cellpadding="0">
                          <tr>
                            <td class="button1" id="completeAp"><a><script>document.write(DashApply);</script></a></td>
                          </tr>
                        </table></td>
                        <td><table width="119" height="39" border="0" cellspacing="0" cellpadding="0">
                          <tr>
                            <td class="button1" id="cancelAp"><a><script>document.write(DashCancel);</script></a></td>
                          </tr>
                        </table>
                        </td>
                      </tr>
                    </table>
                  </td>
                  <td width="25%"></td>
                </tr>
              </table>
            </div>
          </td>
        </tr>
        <tr>
          <td><img src="images/UI-new_11.png" width="960" height="8" /></td>
        </tr>
      </table></td>
    </tr>
  </table>
  <script type="text/javascript">writeFooter();</script>
<!-- End Save for Web Slices -->
</body>
<script type="text/javascript">
  writeWindow("cover");
  writeWindow("waitWindow");
</script>
</html>
