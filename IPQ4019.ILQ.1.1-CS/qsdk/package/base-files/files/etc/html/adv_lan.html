<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
<META HTTP-EQUIV="Expires" CONTENT="0" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="includes/jquery.min.js"></script>
<script type="text/javascript" src="includes/json2.js"></script>
<script type="text/javascript" src="includes/ip_calc.js"></script>
<script type="text/javascript" src="includes/asrock.js"></script>
<script type="text/javascript" src="includes/idletimer.js"></script>
<script type="text/javascript">writeTitle();</script>
<script type="text/javascript" src="lang/multilanguage.js"></script>
<link rel="stylesheet" type="text/css" href="default.css" />
<script type="text/javascript">
var nMac;
function lan_lable(label,id)
{
	 $('#' + id).append("<td colspan=\"2\" align=\"left\" ><h4>" + label + "</h4></td>");
}

function setData(url) {
  var argu;
  var table= document.getElementById("Iplist");
  var rows =  table.getElementsByTagName('tr');
  var autoSetVal = $('input#autoSetting').prop('checked');
  var tablelen = rows.length;
  var  i, j, cells;
  var gValue="&StaticIpList";
  
  for (i = 2, j = rows.length; i < j; ++i) {
    cells = rows[i].getElementsByTagName('td');
    if (!cells.length) {
        continue;
    }
    gValue+="#"+cells[0].innerHTML+"#"+cells[1].innerHTML;
  }
  
  argu = "&Lanipaddr="+$("input#lanip").val();
  argu += "&LanMask="+$("input#mask").val();
  
  var dhcpenable = $('#Dhcponoff').val();
  if(dhcpenable == "ON"){
    argu += "&dhcpenable=1";
  }
  else { 
    argu += "&dhcpenable=0";
  }
  
  argu += "&DomainName="+$("input#domainname").val();
  
  if(autoSetVal)
    argu += "&autoset=1"
  else
  	argu += "&autoset=0"
  argu += "&StartIpAddr="+$("input#startIp").val();
  argu += "&EndIpAddr="+$("input#endIp").val();
  argu += "&Leasetime="+$("input#leasetime").val()+"m";
  argu += gValue+'\0';
  
 //  alert(argu);
/*
  $.ajaxSetup({
    async: false
  });
*/
  $.ajax({
    url: url,
    type: "POST",
    data: argu,
    dataType: "json",
    success: function(result) {
      console.log(result);
    },
    error : function() {
      console.log("post " + url + " error");
    }
  });
/*
  $.ajaxSetup({
    async: true
  });
*/
   return true;
}

function checkwanIpRange(wanIpaddr,wanmask)
{
  var LanIpaddr = $("input#lanip").val();
  var maskpart = [];
  var Ipaddrpart = [];
  var LanIpaddrpart = [];
  var i,j;
  var blegalip = false;
  var IpRang;
  var startAddr = 0;
  
  
  if((wanIpaddr == "unkown")||(wanmask == "unkown"))
    return true;
  
  for(i=0;i<4;i++){
    maskpart[i] = wanmask.split(".")[i];
	Ipaddrpart[i]=wanIpaddr.split(".")[i];
	LanIpaddrpart[i]=LanIpaddr.split(".")[i];
  }
  
  console.log("wan ipaddr = "+Ipaddrpart[0]+"."+Ipaddrpart[1]+"."+Ipaddrpart[2]+"."+Ipaddrpart[3]);
  console.log("wan netmask = "+maskpart[0]+"."+maskpart[1]+"."+maskpart[2]+"."+maskpart[3]);
  
  
  for(i=0;i<3;i++){
    if(maskpart[i] == "255"){
	  if(Ipaddrpart[i] == LanIpaddrpart[i]){
	    continue;
	  }else{
	    blegalip = true;
		break;
	  }
	}else{
	  if(Ipaddrpart[i] == LanIpaddrpart[i])
	     break;
	  
	  IpRang = 256-parseInt(maskpart[i]);
	  //valrang = 256/IpRang;
	  for(j = 0 ; j < 256 ; ){
	    if(parseInt(Ipaddrpart[i]) < j){
		  startAddr = j-IpRang;
		  break;
		}
		j=j+IpRang;
	  }
	  if((parseInt(LanIpaddrpart) > startAddr) && ((parseInt(LanIpaddrpart) - startAddr)>IpRang))
	    blegalip = true;
	}
  }

  return blegalip;
}

function switchDhcpOnOff(swithThis)
{
  console.log("switch state :" + $('#Dhcponoff').val());
}

function checkAutoDHCPRange(checkThis)
{
  if(checkThis){
    $("#startIp").hide();
    $("#endIp").hide();
  }else{
    $("#startIp").show();
    $("#endIp").show();
  }
}

function checkPrivateIP(ipaddr)
{
  var part1=ipaddr.split(".")[0];
  var part2=ipaddr.split(".")[1];
  var part3=ipaddr.split(".")[2];
  var part4=ipaddr.split(".")[3];
  if(part1==10)//class A
  {
    if(part2 >=0 && part2 <=255)
      if(part3 >=0 && part3 <=255)
        if(part4 >=1 && part4 <=254)
          return "A"
  }
  else if(part1==172)//class B
  {
    if(part2>=16 && part2 <=31)
      if(part3 >=0 && part3 <=255)
        if(part4 >=1 && part4 <=254)
          return "B"

  }
  else if(part1==192 && part2==168)//class C
  {
    if(part3 >=0 && part3 <=255)
        if(part4 >=1 && part4 <=254)
          return "C"
  }  
  return "INCORRECT"
}

function checkMasknow(classType,maksaddr,ipaddr)
{
	var bitmap=["0.0.0.0","128.0.0.0","192.0.0.0","224.0.0.0","240.0.0.0","248.0.0.0","252.0.0.0","254.0.0.0","255.0.0.0","255.128.0.0","255.192.0.0","255.224.0.0","255.240.0.0","255.248.0.0","255.252.0.0","255.254.0.0","255.255.0.0","255.255.128.0","255.255.192.0","255.255.224.0","255.255.240.0","255.255.248.0","255.255.252.0","255.255.254.0","255.255.255.0","255.255.255.128","255.255.255.192","255.255.255.224","255.255.255.240","255.255.255.248","255.255.255.252","255.255.255.254","255.255.255.255"];
  var part1=maksaddr.split(".")[0];
  var part2=maksaddr.split(".")[1];
  var part3=maksaddr.split(".")[2];
  var part4=maksaddr.split(".")[3];
  var use_subnet_bits;  
  if(classType == "A")
  {
    if(part1 == 255)
    {
      if(part4!=0)
      {
        if(part3!=255 || part2 !=255)
        return "INCORRECT"
      }
      else
      {
        if(part3!=0)
        {
          if(part2 != 255)
            return "INCORRECT"
        }
      }
    }
    else
      return "INCORRECT"
  }
  else if(classType == "B")
  {
    if(part1 == 255 && part2 == 255)
    {
      if(part4 != 0 && part3 !=255)
        return "INCORRECT"
    }
    else
      return "INCORRECT"
  }
  else if(classType == "C")
  {
    if(part1 == 255 && part2 == 255 && part3 == 255)
    {      
    }
    else
      return "INCORRECT"
  }
  else 
    return "INCORRECT";

  for (var i = 0; i <= 32; i++) {
    if(maksaddr==bitmap[i])
      use_subnet_bits=i;   
  };
  var myIP = new IPv4_Address( ipaddr, use_subnet_bits );
  return myIP
}

function checkIpInMask(ipaddr,sip,eip)
{
  var part1=ipaddr.split(".")[0];
  var part2=ipaddr.split(".")[1];
  var part3=ipaddr.split(".")[2];
  var part4=ipaddr.split(".")[3];
  if(parseInt(sip.split(".")[0])==10)
  {
    if(parseInt(part2)<parseInt(sip.split(".")[1]) || parseInt(part2)>parseInt(eip.split(".")[1]))
    {
      return false
    }
    else
    {
      if(parseInt(part3)<parseInt(sip.split(".")[2]) || parseInt(part3)>parseInt(eip.split(".")[2]))
      {
        return false
      }
      else
      {
        if(parseInt(part4)<parseInt(sip.split(".")[3]) || parseInt(part4)>parseInt(eip.split(".")[3]))
        {
          return false
        }
      }
    }
  }
  else if(parseInt(sip.split(".")[0])==172)
  {
    if(parseInt(part2)<parseInt(sip.split(".")[1]) || parseInt(part2)>parseInt(eip.split(".")[1]))
    {
      return false
    }
    else
    {
      if(parseInt(part3)<parseInt(sip.split(".")[2]) || parseInt(part3)>parseInt(eip.split(".")[2]))
      {
        return false
      }
      else
      {
        if(parseInt(part4)<parseInt(sip.split(".")[3]) || parseInt(part4)>parseInt(eip.split(".")[3]))
        {
          return false
        }
      }
    }
  }
  else if(parseInt(sip.split(".")[0])==192)
  {
    if(parseInt(part3)<parseInt(sip.split(".")[2]) || parseInt(part3)>parseInt(eip.split(".")[2]))
    {
      return false
    }
    else
    {
      if(parseInt(part4)<parseInt(sip.split(".")[3]) || parseInt(part4)>parseInt(eip.split(".")[3]))
        return false
    }
  }
  return true
}

function addList()
{ 	
  var strmac = $('input[name="mac"]').val();
  var strIp = $('input[name="ip"]').val();


  var table= document.getElementById("Iplist");
  var rows =  table.getElementsByTagName('tr');
  var tablelen = rows.length;
  var  i, j, cells, gMacValue,gIpValue;
  var strMacLowerCase,gMacLowerCase; 
  
  if(nMac >= 10){
    alert(InvalidMACnumber);
    return false;
  }
  console.log("mac list number : " + nMac);
  
  for (i = 2, j = rows.length; i < j; ++i) {
    cells = rows[i].getElementsByTagName('td');
    if (!cells.length) {
        continue;
    }
    gMacValue = cells[0].innerHTML;
    gIpValue = cells[1].innerHTML;
	strMacLowerCase = strmac.toLowerCase();
	gMacLowerCase = gMacValue.toLowerCase();
    
	console.log("strMac : "+ strMacLowerCase +"gMacValue : "+ gMacLowerCase);
  //  if((strmac == gMacValue)||(strIp == gIpValue))
    if((strMacLowerCase == gMacLowerCase)||(strIp == gIpValue)){
	   alert(InvalidMAC);
      return false;
	}
  }
 //   console.log("strmac : " + strmac);
 
 
  
  if(strmac.length == 17)
  {
    for (var i=0; i<strmac.length; i++)
    {
      if(i==2 || i==5 || i ==8 || i==11 || i==14)
      {
        if(strmac.charAt(i) != ":")
        {
          alert(InvalidMAC);
          return false;
        }
      }
      else
      {
        if ( (strmac.charAt(i) >= '0' && strmac.charAt(i) <= '9') || (strmac.charAt(i) >= 'a' && strmac.charAt(i) <= 'f') || (strmac.charAt(i) >= 'A' && strmac.charAt(i) <= 'F') )
		    continue;
        alert(InvalidMAC);
        return false;
      }      
    }
	var strmacpart=strmac.slice(0,8);
	
	if((strmacpart == "01:00:5E") || (strmacpart == "01:00:5e")){
	  if(strmac.charAt(9)<='7'){
	    alert(InvalidMAC);
        return false;
	  }
	}
  }  
  else{
    alert(InvalidMAC);
    return false;
  }
  if(!checkIPAddr( $('input[name="ip"]').val() )){
     alert(LANWarn1);
    $('input[name="ip"]').focus();
    return false;
  }
  	nMac++;
	
   return true;
}
/*
function delStaticList(id)
{
  if (!confirm(LANWarn7)) {
  return false;
  }
  else{
  $("[name='staticDHCPList']")[0].deleteRow(id);
  var indexI=0;
    while( indexI < $("[name='input']").length ){
      $("[name='input']")[indexI].id=indexI+2;
      indexI++;
    }
    return true
  }
}
*/

function checkDHCPRange(){

  var bcheckiprange = false;
  var ret;

   
    if( parseInt($("input#endIp").val().split(".")[1]) >= parseInt($("input#startIp").val().split(".")[1]) )
    {
      if( parseInt($("input#endIp").val().split(".")[2]) >= parseInt($("input#startIp").val().split(".")[2]) )
      {
        if( parseInt($("input#endIp").val().split(".")[1]) == parseInt($("input#startIp").val().split(".")[1]) && 
            parseInt($("input#endIp").val().split(".")[2]) == parseInt($("input#startIp").val().split(".")[2]) &&
            parseInt($("input#endIp").val().split(".")[3]) <= parseInt($("input#startIp").val().split(".")[3]) )
        {
          alert(LANWarn6);
          return false;
        }
      }
      else
      {
        alert(LANWarn6);
        return false;
      }
    }
    else
    {
      alert(LANWarn6);
      return false;
    }
	
	console.log("lanip [1] = "+parseInt($("input#lanip").val().split(".")[1])+"startIp [1] = "+parseInt($("input#startIp").val().split(".")[1]));
	console.log("lanip [2] = "+parseInt($("input#lanip").val().split(".")[2])+"startIp [2] = "+parseInt($("input#startIp").val().split(".")[2]));
	console.log("lanip [3] = "+parseInt($("input#lanip").val().split(".")[3])+"startIp [1] = "+parseInt($("input#startIp").val().split(".")[3]));
	console.log("lanip [1] = "+parseInt($("input#lanip").val().split(".")[1])+"endIp [1] = "+parseInt($("input#endIp").val().split(".")[1]));
	console.log("lanip [2] = "+parseInt($("input#lanip").val().split(".")[2])+"endIp [2] = "+parseInt($("input#endIp").val().split(".")[2]));
	console.log("lanip [3] = "+parseInt($("input#lanip").val().split(".")[3])+"endIp [1] = "+parseInt($("input#endIp").val().split(".")[3]));
	
	if( parseInt($("input#lanip").val().split(".")[1]) >= parseInt($("input#startIp").val().split(".")[1]) )
    {
      if( parseInt($("input#lanip").val().split(".")[2]) >= parseInt($("input#startIp").val().split(".")[2]) )
      {
        if( parseInt($("input#lanip").val().split(".")[1]) == parseInt($("input#startIp").val().split(".")[1]) && 
            parseInt($("input#lanip").val().split(".")[2]) == parseInt($("input#startIp").val().split(".")[2]) &&
            parseInt($("input#lanip").val().split(".")[3]) >= parseInt($("input#startIp").val().split(".")[3]) )
        {
          bcheckiprange = true;
        //  return false;
        }
      }
      else
      {
         bcheckiprange = true;
        //return false;
      }
    }
    else
    {
       bcheckiprange = true;
    }
	
	console.log("bcheckiprange = "+bcheckiprange);
	if(bcheckiprange == true){
	
	  if( parseInt($("input#endIp").val().split(".")[1]) >= parseInt($("input#lanip").val().split(".")[1]) )
      {
        if( parseInt($("input#endIp").val().split(".")[2]) >= parseInt($("input#lanip").val().split(".")[2]) )
        {
          if( parseInt($("input#endIp").val().split(".")[1]) == parseInt($("input#lanip").val().split(".")[1]) && 
              parseInt($("input#endIp").val().split(".")[2]) == parseInt($("input#lanip").val().split(".")[2]) &&
              parseInt($("input#endIp").val().split(".")[3]) >= parseInt($("input#lanip").val().split(".")[3]) )
            {
              ret = confirm(WANLan1);
              return ret;
            }
        }
         else
        {
           ret = confirm(WANLan1);
           return ret;
        }
       }
        else
       {
          ret = confirm(WANLan1);
          return ret;
       }
	}
	   
	
   return true;
     
}

function checkData(){
	var reg=/\W/;
	var autoSetVal = $('input#autoSetting').prop('checked');
	var ret = true;
	
	if(!checkIPAddr( $("input#lanip").val() )){
        alert(LANWarn1);
    //  alert("Invalid LAN IP address");
      $("input#lanip").focus();
      return false;
    }

  if (checkIPMask( $("input#mask").val() ) == false){
    $("input#mask").focus();
    return false;
  }

     var Namevalue=$("input#domainname").val();
   //  NameLen = Namevalue.length;
    for(i=0;i<Namevalue.length;i++){
      if(reg.test(Namevalue[i]) && Namevalue[i]!="-"){
        alert(PopMsg1);
         $("input#domainname").focus();
        return false;
      }
    }
    
    if(isNaN( $("input#leasetime").val())){
      alert(LANWarn2);
      $("#leasetime").focus();
      return false;
    }else if((parseInt($("input#leasetime").val())<2)||(parseInt($("input#leasetime").val())>10080)){
	  alert(LANWarn8);
	  $("#leasetime").focus();
      return false;
	}
    
      var classTypeNow = checkPrivateIP($("input#lanip").val());
      var iprange;
     if(classTypeNow == "INCORRECT")
     {
       alert(LANWarn1);
       return false
     }
     else
     {
       iprange = checkMasknow(classTypeNow,$("input#mask").val(),$("input#lanip").val());
       if(iprange == "INCORRECT")
       {
          alert(SetupWarn5);
          return false;
       }    
     }
     
      var startip = iprange.netaddressDotQuad.split(".")[0]+"."+
              iprange.netaddressDotQuad.split(".")[1]+"."+
              iprange.netaddressDotQuad.split(".")[2]+"."+
              (parseInt(iprange.netaddressDotQuad.split(".")[3])+1);
      var endip = iprange.netbcastDotQuad.split(".")[0]+"."+
              iprange.netbcastDotQuad.split(".")[1]+"."+
              iprange.netbcastDotQuad.split(".")[2]+"."+
              (parseInt(iprange.netbcastDotQuad.split(".")[3])-1);  

  
  //   if(document.getElementById("autoSetting").checked==true){
    if(autoSetVal){
     	 console.log("startip = " + startip + "endIp = "+ endip);
  	   $("input#startIp").val(startip);
       $("input#endIp").val(endip);
     }else{
	    if(!checkIPAddr( $("input#startIp").val() )){
          alert(LANWarn3);
          $("input#startIp").focus();
          return false;
        }
        if(!checkIPAddr( $("input#endIp").val() )){
          alert(LANWarn4);
          $("input#endIp").focus();
          return false;
        }
        if(checkPrivateIP($("input#startIp").val())=="INCORRECT")
        {
          alert(LANWarn3);
          return false
        }
        else
        {
           if(!checkIpInMask($("input#startIp").val(),startip,endip))
           {
             alert(LANWarn5);
             return false
           }  
        }
        if(checkPrivateIP($("input#endIp").val())=="INCORRECT")
        {
           alert(LANWarn4);
           return false
        }
        else
        {
          if(!checkIpInMask($("input#endIp").val(),startip,endip))
          {
            alert(LANWarn4);
            return false
          }  
        }

         ret = checkDHCPRange();
      }   
  
  return ret; 
}

function addStaticIpTable(id,strmac,strip){
	
	var bg = "";
    if ((($('#' + id + ' tbody').children().length) % 2) == 0) {
      bg = "bgcolor=\"#333333\"";
    }

    var row = "<tr>";
    row += "<td class=\"style5\" style=\"text-align:center;\"" + bg + ">"+ strmac +"</td>";
    row += "<td class=\"style5\" style=\"text-align:center;\"" + bg + ">"+ strip +"</td>";
    row += "<td class=\"" + id + "Del\"align=\"center\"" + bg + "><img src=\"images/icon-.png\" width=\"18\" height=\"18\"/></td>"
    row += "</tr>"
    $('#' + id + ' tbody').append(row);
}

function getStaticIPList(strStaticIPList){
	var items = strStaticIPList.split("#");
	var i,j;
	console.log(items.length);
    
	nMac = 0;
	for(i=0;i<items.length;i++){
		var iData = items[i].split("|");
		if (iData[0] != "" && iData[1] !== undefined) {
		  addStaticIpTable("Iplist",iData[0],iData[1]);
          if(iData[0] != "")		  
		    nMac++;
		}
	}
}

$(document).ready(function() {
  var id, head, body;
    isLoggedIn ();

  $('#lanMenu').parent().removeClass('menu');
  $('#lanMenu').parent().addClass('mainmenu');
  $('#lanMenu').find('.submenu').addClass('show_menu');
  $('.show_menu').show();
  $('#lanLan').removeClass('show_menu');
  $('#lanLan').removeClass('submenu');
  $('#lanLan').addClass('mainsubmenu');
  $('#lanLan').addClass('show_menu');

  console.log("document ready!!!");
  
  /* Empty category arrays */
  emptyElementArrays();
 
 lan_lable(LANSetting,"lansetting");
  
  text(AdvIPAddr, "lanip");
  $('input#lanip').attr('size', 16);
  $('input#lanip').attr('maxlength', 15);
  text(AdvSubnetMask, "mask");
  $('input#mask').attr('size', 16);
  $('input#mask').attr('maxlength', 15);
  
  lan_lable(LANDHCP,"landhcp");
  
  switchOnOff(LANDHCPServer, "Dhcponoff", switchDhcpOnOff);
  
  text(LANDomainName, "domainname");
  $('input#domainname').attr('size', 16);
  $('input#domainname').attr('maxlength', 15);
  checkbox(undefined,"autoSetting",LanAutoSet,checkAutoDHCPRange);
  
  text(LANLeaseTime, "leasetime",LANminutes);
  $('input#leasetime').attr('size', 6);
  $('input#leasetime').attr('maxlength', 5);
  text(LANStartAddr,"startIp");
  $('input#startIp').attr('size', 16);
  $('input#startIp').attr('maxlength', 15);
  text(LANEndAddr,"endIp");
  $('input#endIp').attr('size', 16);
  $('input#endIp').attr('maxlength', 15);
  $("#startIp").hide();
  $("#endIp").hide();
  
  lan_lable(LANManuallyIPAssign,"lanStaticIp");

  var items = [{"name": LANMACAddr, "value": "mac", "maxSize": "17"}, 
               {"name": LANIPAddr, "value": "ip", "maxSize": "15"}];
  
  id = "Iplist";
  head = [{"desc" : LANMACAddr, "width" : "30%"},
          {"desc" : LANIPAddr, "width" : "30%"},
          {"desc" : ParAddDelete, "width" : "10%"}];
  body = [{"bgcolor" : "#333333", "isInput" : "1", "maxSize" : "17", "name" : "mac"}, 
          {"bgcolor" : "#333333", "isInput" : "1", "maxSize" : "15", "name" : "ip"}, 
          {"id" : id + "Add", "bgcolor" : "#333333", "isImage" : "1", "imgSrc" : "images/icon+.png"}];
  tableList(id, head, body);
  $('#' + id + 'Add').click(function() {
    var id, macAddr, ipAddr;
    id = "Iplist";
    macAddr = $('input[name="mac"]').val();
	ipAddr = $('input[name="ip"]').val();
    if (addList() == true) {
      var body, bodyIp, bodyMac, bodyDelete;
	  $('input[name="mac"]').val("");
	  $('input[name="ip"]').val("");
      if ((($('#' + id + 'TableBody').children().length) % 2) == 0) {
        bodyMac = {"align" : "center", "bgcolor" : "#333333", "value" : macAddr};
        bodyIp = {"align" : "center", "bgcolor" : "#333333", "value" : ipAddr};
        bodyDelete = {"classes" : id + "Del", "bgcolor" : "#333333", "isImage" : "1", "imgSrc" : "images/icon-.png"};
      }
      else {
        bodyMac = {"align" : "center", "value" : macAddr};
        bodyIp = {"align" : "center", "value" : ipAddr};
        bodyDelete = {"classes" : id + "Del", "isImage" : "1", "imgSrc" : "images/icon-.png"};
      }
      body = [bodyMac, bodyIp, bodyDelete];
      $('#' + id + 'TableBody').append(newTableBody(body));
    }
  });
  $('#' + id + 'TableBody').on("click", '.' + id + 'Del', function() {
    $(this).closest('tr').remove();
  });
  
 var LanInfo = getData("/f/getLanSetting");
  if(LanInfo != null){
  	$.each(LanInfo,function(key,value){
  		//console.log("key : " + key + " value : " + value);
  		var strStaticIPList;
  		
  		if(key == "Lanipaddr")
  		  $('input#lanip').val(value);
  		if(key == "LanMask")
  		  $('input#mask').val(value);
  		if(key == "dhcpenable"){	
  			if(value == "enable"){
  			  $('span#Dhcponoff').trigger("click");
  			  $('#Dhcponoff').val("ON");
  			}
  		}
  		if(key == "DomainName")
  		  $('input#domainname').val(value);
  		if(key == "AutoSetting"){
  		 if( value == "OFF"){
  		 	 $('input#autoSetting').prop("checked", false);
  		 	 $("#startIp").show();
         $("#endIp").show();
  		 }else if(value == "ON"){
  		 	 $('input#autoSetting').prop("checked", true);
  		 	 $("#startIp").hide();
         $("#endIp").hide();
  		 }
  		}
  		if(key == "StartIpAddr")
  		  $('input#startIp').val(value);
  		if(key == "EndIpAddr")
  		   $('input#endIp').val(value);
  		if(key == "Leasetime")
  		   $('input#leasetime').val(value);
  		if(key == "StaticIpList")
  		   getStaticIPList(value);
    });
  }

  /* Apply action */
  $("#Apply").click(function(event) {
    var ret= true;
	var getLanaddr,getNetmask;
	var WanIp, WanNetmask;
  
  ret = checkData();
  if(ret==true){
    var setLanIpaddr = $("input#lanip").val();
    var setNetMask = $("input#mask").val();
	
	var getLanInfo = getData("/f/getLanSetting");
    if(getLanInfo != null){
	  $.each(LanInfo,function(key,value){
	    if(key == "Lanipaddr")
  	      getLanaddr = value;
  	    if(key == "LanMask")
  		  getNetmask = value;
		if(key == "Wanipaddr")
			WanIp = value;
		if(key == "Wannetmask")
		    WanNetmask = value;
	  });
	}
	
	console.log("Wan Ip address : "+WanIp+"Wan netmask"+WanNetmask);
	if(!checkwanIpRange(WanIp,WanNetmask)){
	  alert(LANWarn1);
      $("input#lanip").focus();
	  return;
	}
		
    console.log("setLanIpaddr : "+setLanIpaddr+"getLanaddr : "+ getLanaddr);
    if(setData("/f/setLanSetting")){
      if((getLanaddr != setLanIpaddr)||(getNetmask != setNetMask)){
         doLanReboot(setLanIpaddr, "/adv_lan.html");
      }else{
        waitTimeout = 20;
        showWindow("waitWindow");
        countdownWindow("waitingDig");
      }
    }
  }
  

  });
  
  /* Cancel action */
  $("#Cancel").click(function(event) {
    console.log("cancel click...");
    refresh();
  });
});
</script>
</head>
<body onload="preloadX10Images()">
<div style="width:960px;margin:0px auto;">
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td height="20" valign="top">&nbsp;</td>
        </tr>
        <script type="text/javascript">writeHeader();</script>
        <tr>
          <td align="left" background="images/UI-new_10.png"><table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td>&nbsp;</td>
              <td width="168">&nbsp;</td>
              <td>&nbsp;</td>
              <td width="736" align="center" valign="top">&nbsp;</td>
            </tr>
            <tr>
              <td width="20">&nbsp;</td>
              <td valign="top"><table border="0" cellspacing="0" cellpadding="0">
                <script type="text/javascript">writeLeftMenu();</script> 
              </table></td>
              <td width="15">&nbsp;</td>
              <td align="center" valign="top"><table width="98%" border="0" cellspacing="2" cellpadding="2">
                <tr id="lansetting">
                </tr>
                <tr>
                   <td colspan="2" align="left" class="style8"><img src="images/line-s.png" width="470" height="5" /></td>
                </tr>
                <tr id="lanip">
                </tr>
                <tr id="mask">
                </tr>
                <tr><td>&nbsp;</td></tr>
                <tr><td>&nbsp;</td></tr>
                <tr id="landhcp">
                </tr>
                <tr id="Dhcponoff">
                </tr>
                <tr id="domainname">
                </tr>
                <tr id="autoSetting">
                </tr>
                <tr id="startIp">
                </tr>
                <tr id="endIp">
                </tr>
                <tr id="leasetime">
                </tr>
                <tr><td>&nbsp;</td></tr>
                <tr><td>&nbsp;</td></tr>
                <tr id="lanStaticIp">
                </tr>
                <tr id="Iplist">
		        </tr>
                <script type="text/javascript">writeApplyCancel();</script>
              </table></td>
            </tr>
          </table></td>
        </tr>
        <tr>
          <td><img src="images/UI-new_11.png" width="960" height="8" /></td>
        </tr>
      </table></td>
    </tr>
  </table>
  <script type="text/javascript">writeFooter();</script>
</div>
<!-- End Save for Web Slices -->
<script type="text/javascript">
  writeWindow("cover");
  writeWindow("waitWindow");
</script>
</body>
</html>
